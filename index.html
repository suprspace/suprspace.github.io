<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content= "ie=edge">
    <title>UN 2.0</title>
    
    <script
  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>
    <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>     
</head>
    
<style>
    :root {
        --pixel-size: 5px;
        --grid-cell: calc(var(--pixel-size)*16);
    }
    @media (max-width: 900px) {
        :root {
            --pixel-size: 4px;
        }
    }
    @media (max-width: 700px) {
        :root {
            --pixel-size: 3px;
        }
    }
    @media (max-width: 600px) {
        :root {
            --pixel-size: 2px;
        }
    }
    .pixel-art {
        image-rendering: pixelated;
    }
    html, body {
        height: 100%;
        overflow: hidden;
        background-color: #000;
    }
    body {
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .camera {
        width: calc(var(--pixel-size)*160);
        height: calc(var(--pixel-size)*160);
        overflow: hidden;
        position: relative;
        border: solid white;
        border-width: calc(var(--pixel-size)*.1);
        border-radius: calc(var(--pixel-size)*2);
    }
    .map {
        image-rendering: pixelated;
        background-image: url("/grass.png");
        background-size: 100%;
        width: calc(var(--grid-cell)*10);
        height: calc(var(--grid-cell)*10);
        position: relative;
    }
    .icon {
        width: calc(var(--grid-cell)*2);
        height: calc(var(--grid-cell)*2);
        background-image: url("astro.png");
        background-size: 100%;
        position: absolute;
        overflow: hidden;
    }
    
</style>
    
<body>
    <div style="top:calc(var(--grid-cell)*.5);position:fixed;">
    <div class="camera">
        <div class="map pixel-art">
        <div class="icon" facing="down" walking="true"></div>
        </div>
    </div>
    </div>
</body>
    
<script>
    var icon = document.querySelector(".icon");
    var map = document.querySelector(".map");
    
    var x = 0;
    var y = 0;
    var held_directions = [];
    
    var speed = 1;
    
    const placeIcon = () => {
        
        var pixelSize = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--pixel-size'));
        
        const held_direction = held_directions[0];
        if (held_direction) {
            if (held_direction === directions.right) {x += speed;}
            if (held_direction === directions.left) {x -= speed;}
            if (held_direction === directions.down) {y += speed;}
            if (held_direction === directions.up) {y -= speed;}
            icon.setAttribute("facing", held_direction);
        }
        icon.setAttribute("walking", held_direction ? "true" : "false");
        
        
        var camera_left = pixelSize * 65;
        var camera_top = pixelSize * 65;
        
        map.style.transform = `translate3d( ${-x*pixelSize}px, ${-y*pixelSize}px, 0)`;
        
        icon.style.transform = `translate3d( ${x*pixelSize+camera_left}px, ${y*pixelSize+camera_top}px, 0)`;
    }
    
    const step = () => {
        placeIcon();
        window.requestAnimationFrame(() => {
            step();
        })
    }
    step();
    
    const directions = {
        up: "up",
        down: "down",
        left: "left",
        right: "right",
    }
    const keys = {
        38: directions.up,
        39: directions.right,
        37: directions.left,
        40: directions.down,
    }    
    
    document.addEventListener("keydown", (e) => {
        var dir = keys[e.which];
        if (dir && held_directions.indexOf(dir) === -1) {
            held_directions.unshift(dir)
        }
    })
    document.addEventListener("keyup", (e) => {
        var dir = keys[e.which];
        var index = held_directions.indexOf(dir);
        if (index > -1) {
            held_directions.splice(index, 1)
        }
    });
</script>
</html>